(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{597:function(s,t,a){"use strict";a.r(t);var e=a(9),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"在服务器上搭建静态博客"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在服务器上搭建静态博客"}},[s._v("#")]),s._v(" 在服务器上搭建静态博客")]),s._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("​\t之前在服务器上搭建了基于"),a("code",[s._v("Halo")]),s._v("的动态博客系统，可以通过网页后台，方便进行博客写作和管理。但苦于资金有限，服务器性能一般，服务器除了要处理访问，还要挂着守护进程。于是就希望能有适于低性能服务器的解决方案。")]),s._v(" "),a("p",[s._v("​\t同时，自己一直通过"),a("code",[s._v("GithubPage")]),s._v("托管一部分博客，一直没能统一部署，所以希望能够寻求到能够同时部署到服务器和github.io的方案。")]),s._v(" "),a("p",[s._v("​\t这几天发现一个关于此的专栏（见文末引用），于是跟着步骤做了一遍。所以此篇为备忘。")]),s._v(" "),a("h2",{attrs:{id:"停用halo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停用halo"}},[s._v("#")]),s._v(" 停用Halo")]),s._v(" "),a("p",[s._v("先ssh连接到服务器，停用"),a("code",[s._v("Halo")]),s._v("的守护进程")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("systemctl disable halo\nsystemctl stop halo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"配置静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置静态资源"}},[s._v("#")]),s._v(" 配置静态资源")]),s._v(" "),a("p",[s._v("首先将已经托管在"),a("code",[s._v("GithubPage")]),s._v("的仓库克隆到"),a("code",[s._v("nginx")]),s._v("的默认静态资源目录"),a("code",[s._v("/var/www/html")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/html\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone xxxxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("修改nginx的配置文件，将刚刚克隆的资源目录添加为root字段的值")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tlisten "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" default_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tlisten "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":80 default_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\troot /var/www/html/xxx.github.io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"测试静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试静态资源"}},[s._v("#")]),s._v(" 测试静态资源")]),s._v(" "),a("p",[s._v("在浏览器输入服务器的ip和端口号（一般为80，就是nginx配置文件中的）")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("xxx.xxx.xxx.xxx:80\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果成功加载网页，就说明之前的配置成功。")]),s._v(" "),a("p",[s._v("但现在无法使用之前的配置进行"),a("code",[s._v("域名访问")]),s._v("。只需要将之前在"),a("code",[s._v("/etc/nginx/config.d/")]),s._v("下的配置文件（这是Ubuntu的nginx目录，红帽系的可能有所不同）里有root字段的目录也改为和上文nginx配置文件里的一样的就好。（Halo原来的配置为通过代理监听Halo的端口。）")]),s._v(" "),a("p",[s._v("至此，已经可以通过域名访问从github克隆到服务器的静态资源了。")]),s._v(" "),a("h2",{attrs:{id:"配置同时部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置同时部署"}},[s._v("#")]),s._v(" 配置同时部署")]),s._v(" "),a("p",[s._v("如果想将本地机里的静态资源同时部署到github和服务器的话，就需要在服务器也创建一个git仓库，并在本地机里将hexo根目录下配置文件里的deploy项进行修改。")]),s._v(" "),a("h4",{attrs:{id:"创建仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建仓库"}},[s._v("#")]),s._v(" 创建仓库")]),s._v(" "),a("p",[s._v("首先创建一个git用户，用m选项添加家目录，并将其加入root用户组")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" -m -G root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("进入git的家目录并创建裸仓库"),a("code",[s._v("hexo.git")]),s._v(",并将仓库所有者和组权限进行修改")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/git/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init --bare hexo.git\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R git:git hexo.git\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/html/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R git:git xxx.github.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("配置仓库储存位置，在配置文件"),a("code",[s._v("/home/git/hexo.git/hooks/post-receive")]),s._v("中写入如下内容：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" --work-tree"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/html/xxx.github.io --git-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/git/hexo.git checkout -f\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("保存之后，为该文件添加可执行权限")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x post-receive\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这样，一会儿部署的静态资源就会储存到nginx的默认静态资源目录（见前文）。")]),s._v(" "),a("p",[s._v("除此，为了在部署时免除密码，需要将本地机的ssh公钥导入git家目录下的"),a("code",[s._v("~/.ssh/authorized_keys")]),s._v("文件中。（如果在root或默认目录下有，也可以复制一份）。")]),s._v(" "),a("h3",{attrs:{id:"配置本地机部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置本地机部署"}},[s._v("#")]),s._v(" 配置本地机部署")]),s._v(" "),a("p",[s._v("编辑本地机的Hexo根目录下的配置文件（"),a("code",[s._v("_config.yml")]),s._v("）,修改"),a("code",[s._v("deploy")]),s._v("的内容：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Deployment")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Docs: https://hexo.io/docs/one-command-deployment")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" git\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" git@github.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("your_github_name/your_github_name.github.io.git"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("main\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hexo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" git@your_server_ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/home/git/hexo.git"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h5",{attrs:{id:"至此-使用hexo-d就可以同时部署到githubpage和自己的服务器上了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#至此-使用hexo-d就可以同时部署到githubpage和自己的服务器上了"}},[s._v("#")]),s._v(" 至此，使用"),a("code",[s._v("hexo d")]),s._v("就可以同时部署到GithubPage和自己的服务器上了！")]),s._v(" "),a("p",[s._v("References：")]),s._v(" "),a("p",[s._v("https://zhuanlan.zhihu.com/p/58654392")])])}),[],!1,null,null,null);t.default=n.exports}}]);